<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body {
            margin: 0;
            background: #000000;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        #watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.04);
            font-size: 10vw;
            font-weight: 900;
            letter-spacing: -0.05em;
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
            text-transform: uppercase;
        }
    </style>
</head>

<body>
    <div id="watermark">ASC TERMINAL</div>
    <div id="chart" style="width:100vw;height:100vh;position:relative;z-index:10"></div>
    <script>
        let chart, candleSeries, bslSeries, sslSeries;

        function init() {
            chart = LightweightCharts.createChart(document.getElementById('chart'), {
                width: window.innerWidth,
                height: window.innerHeight,
                layout: {
                    background: { color: 'transparent' },
                    textColor: '#64748b',
                    fontSize: 11
                },
                grid: {
                    vertLines: { color: 'rgba(255, 255, 255, 0.03)' },
                    horzLines: { color: 'rgba(255, 255, 255, 0.03)' }
                },
                rightPriceScale: {
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    autoScale: true,
                },
                timeScale: {
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    timeVisible: true,
                },
                crosshair: {
                    vertLine: { color: '#6366f1', labelBackgroundColor: '#6366f1', style: 2 },
                    horzLine: { color: '#6366f1', labelBackgroundColor: '#6366f1', style: 2 },
                }
            });

            candleSeries = chart.addCandlestickSeries({
                upColor: '#10b981',
                downColor: '#f43f5e',
                borderVisible: false,
                wickUpColor: '#10b981',
                wickDownColor: '#f43f5e'
            });
        }

        window.updateData = function (jsonPayload) {
            if (!chart) init();
            try {
                const data = JSON.parse(jsonPayload);
                candleSeries.setData(data);

                const highs = data.map(d => d.high);
                const lows = data.map(d => d.low);
                const maxH = Math.max(...highs);
                const minL = Math.min(...lows);

                if (!bslSeries) {
                    bslSeries = chart.addLineSeries({
                        color: 'rgba(244, 63, 94, 0.15)',
                        lineWidth: 2,
                        lineStyle: 2,
                        priceLineVisible: false,
                        lastValueVisible: false,
                    });
                }
                bslSeries.setData(data.map(d => ({ time: d.time, value: maxH })));

                if (!sslSeries) {
                    sslSeries = chart.addLineSeries({
                        color: 'rgba(16, 185, 129, 0.15)',
                        lineWidth: 2,
                        lineStyle: 2,
                        priceLineVisible: false,
                        lastValueVisible: false,
                    });
                }
                sslSeries.setData(data.map(d => ({ time: d.time, value: minL })));

                chart.timeScale().fitContent();
            } catch (e) { console.error(e); }
        }

        window.addEventListener('resize', () => {
            if (chart) chart.resize(window.innerWidth, window.innerHeight);
        });
        init();
    </script>
</body>

</html>